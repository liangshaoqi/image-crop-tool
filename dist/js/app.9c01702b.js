(function(e){function t(t){for(var a,o,s=t[0],c=t[1],l=t[2],h=0,p=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&p.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return r.push.apply(r,l||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],a=!0,s=1;s<i.length;s++){var c=i[s];0!==n[c]&&(a=!1)}a&&(r.splice(t--,1),e=o(o.s=i[0]))}return e}var a={},n={app:0},r=[];function o(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=a,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(i,a,function(t){return e[t]}.bind(null,a));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"043b":function(e,t,i){"use strict";var a=i("05c7"),n=i.n(a);n.a},"05c7":function(e,t,i){},2367:function(e,t,i){},"299f":function(e,t,i){},3576:function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);i("a133"),i("ed0d"),i("f09c"),i("e117");var a=i("0261"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("CropContainer",{attrs:{width:200,height:200}})],1)},r=[],o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"crop-container"},[i("Crop",{ref:"crop",attrs:{width:200,height:200}})],1)},s=[],c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"crop-operate-view"},[i("div",{staticClass:"view-area"},[i("MainCropView"),i("Preview")],1),i("Toolbar",{ref:"toolbar"})],1)},l=[],u=(i("513c"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"crop-main-view",style:e.getStyle},[i("div",{staticClass:"original-image-view",style:e.getStyle},[""!==e.originalImageBase64?i("div",{staticClass:"crop-opreate-view",style:e.originalImageContainerStyle,attrs:{id:"crop_opreate_view"}},[i("img",{directives:[{name:"show",rawName:"v-show",value:""!==e.originalImageBase64,expression:"originalImageBase64 !== ''"}],staticClass:"original-image",style:e.originalImageStyle,attrs:{id:"original-image",src:e.originalImageBase64,alt:"图片转化失败,请刷新重试"},on:{load:function(t){return e.imageLoad(t)}}}),i("cropFrame")],1):e._e()])])}),h=[],p=i("d0f5"),f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return""!=e.originalImageBase64?i("div",{directives:[{name:"drag",rawName:"v-drag"}],ref:"crop_frame_view",staticClass:"crop-frame-view",style:e.getCropFrameStyle,attrs:{id:"crop_frame_view"}},[i("div",{directives:[{name:"scale",rawName:"v-scale",value:"left-up",expression:"'left-up'"}],staticClass:"square left-up"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"up",expression:"'up'"}],staticClass:"square up"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"right-up",expression:"'right-up'"}],staticClass:"square right-up"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"left",expression:"'left'"}],staticClass:"square left"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"right",expression:"'right'"}],staticClass:"square right"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"left-down",expression:"'left-down'"}],staticClass:"square left-down"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"down",expression:"'down'"}],staticClass:"square down"}),i("div",{directives:[{name:"scale",rawName:"v-scale",value:"right-down",expression:"'right-down'"}],staticClass:"square right-down"})]):e._e()},d=[],g=i("9f3a");i("44e4"),i("20a5"),i("e18c"),i("e35a"),i("f4e3"),i("0d7a"),i("8256"),i("ab6e"),i("927c"),i("3c51"),i("db0a"),i("1cc1"),i("ab0f"),i("fc6e"),i("f30b"),i("cfd1"),i("d104"),i("f74a"),i("3598"),i("b497"),i("2909"),i("a7ef"),i("b523"),i("e671"),i("4140"),i("83db"),i("829d"),i("939f"),i("1bb1"),i("c3ba");function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"downloadImage",i=e.split(","),a=i[0].match(/:(.*?);/)[1],n=atob(i[1]),r=n.length,o=new Uint8Array(r);while(r--)o[r]=n.charCodeAt(r);return new File([o],t,{type:a})}function v(e){var t=new FileReader;return t.readAsDataURL(e),new Promise((function(e){t.onload=function(){var i=new Image;i.src=t.result,i.onload=function(){var a=i.width,n=i.height,r={width:a,height:n,result:t.result};e(r)}}}))}function w(e,t,i,a){var n=e/t,r=i/a,o=function(n){"width"===n?(i=e,a=e/r):(a=t,i=t*r)};return n===r&&(i=e,a=t),n>=1&&o(r>=n?"width":"height"),n<1&&(r>=n&&o("width"),r<n&&o("height")),{width:i,height:a}}function b(e,t,i){this.$store.state.cropImageAttr.scale;var a=document.getElementById("preview_square"),n=a.width,r=a.height,o=a.getContext("2d"),s=document.getElementById("original-image"),c=s.naturalWidth,l=s.naturalHeight,u=c/s.width,h=l/s.height;e?o.drawImage(s,e.left*u,e.top*h,e.width*u,e.height*h,0,0,n,r):o.drawImage(s,0,0,n*u,n*h,0,0,n,r)}function y(e){var t=document.getElementById("preview_square"),i=t.getContext("2d");i.clearRect(0,0,t.width,t.height)}function x(e,t){if(navigator.msSaveBlob){var i=e.msToBlob();navigator.msSaveBlob(i,t)}else{var a=e.toDataURL("image/png",1),n=document.createElement("a");if(n.download=t,n.href=a,document.body.appendChild(n),n.click)n.click();else{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window),n.dispatchEvent(r)}document.body.removeChild(n)}}function I(e){var t=document.getElementById(e);null!==t&&(t.style.top="0px",t.style.left="0px")}var _={data:function(){return{}},computed:Object(p["a"])(Object(p["a"])({},Object(g["c"])({originalImageBase64:"originalImageBase64"})),{},{getCropFrameStyle:function(){var e="",t=0,i=0;return this.ratio>1?(t=this.previewUtinPx,i=this.ratio*this.previewUtinPx):(t=this.ratio*this.previewUtinPx,i=this.previewUtinPx),e+="width: "+t+"px;",e+="height: "+i+"px;",e}}),directives:{drag:function(e,t,i){var a=i.context,n=e;n.onmousedown=function(e){e.stopPropagation();var t=e.clientX-n.offsetLeft,i=e.clientY-n.offsetTop,r=document.getElementById("crop_frame_view"),o=document.getElementById("crop_opreate_view");document.onmousemove=function(e){e.stopPropagation();var s=e.clientX-t,c=e.clientY-i,l=o.offsetWidth,u=o.offsetHeight,h=r.offsetWidth,p=r.offsetHeight,f=r.offsetLeft,d=r.offsetTop;s<0&&(s=0),c<0&&(c=0),f+h>=l&&s>l-h&&(s=l-h),d+p>=u&&c>u-p&&(c=u-p),n.style.left=s+"px",n.style.top=c+"px";var g={left:s,top:c,width:h,height:p};b.call(a,g)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}},scale:function(e,t,i){var a=i.context,n=e,r=t.value;n.onmousedown=function(e){e.stopPropagation();var t=document.getElementById("crop_frame_view"),i=document.getElementById("original-image"),n=t.offsetLeft,o=t.offsetTop,s=t.offsetWidth,c=t.offsetHeight,l=s-2,u=c-2,h=i.offsetLeft,p=i.offsetTop,f=i.width,d=i.height,g=e.clientX,m=e.clientY,v=function(e){var i=e.clientX,a=g-i+l,r=n-(g-i);i-g>l||(r<0&&(r=0,a=l+n),t.style.width=a+"px",t.style.left=r+"px")},w=function(e){var i=e.clientX,a=i-g+l;n+a>=h+f-2&&(a=h+f-n-2),t.style.width=a+"px"},x=function(e){var i=e.clientY,a=o-(m-i),n=m-i+u;i-m>u||(a<0&&(a=0,n=u+o),t.style.height=n+"px",t.style.top=a+"px")},I=function(e){var i=e.clientY,a=i-m+u;o+a>=p+d&&(a=p+d-o),t.style.height=a+"px"};document.onmousemove=function(e){switch(e.stopPropagation(),r){case"left":v(e);break;case"right":w(e);break;case"up":x(e);break;case"down":I(e);break;case"left-up":v(e),x(e);break;case"right-up":w(e),x(e);break;case"left-down":v(e),I(e);break;case"right-down":w(e),I(e);break;default:break}y(),b.call(a,{width:t.offsetWidth,height:t.offsetHeight,left:t.offsetLeft,top:t.offsetTop})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}}},inject:["width","height","ratio","previewUtinPx"],methods:{clipRangeData:function(e){var t=e.offsetLeft,i=e.offsetTop,a={};return a.left=t<=0?0:t,a.top=i<0?0:i,a}}},C=_,j=(i("e84e"),i("9ca4")),O=Object(j["a"])(C,f,d,!1,null,null,null),B=O.exports,P={components:{cropFrame:B},props:{ratio:{type:Array,default:function(){return[3,2]}}},data:function(){return{cropImageSrc:""}},inject:["cropViewWidth","cropViewHeight"],computed:Object(p["a"])(Object(p["a"])({},Object(g["c"])(["originalImageBase64","cropImageAttr"])),{},{getStyle:function(){var e="";return e+="width: "+this.cropViewWidth+"px;",e+="height: "+this.cropViewHeight+"px;",e},originalImageContainerStyle:function(){var e="",t=w(this.cropViewWidth,this.cropViewHeight,this.cropImageAttr.width,this.cropImageAttr.height),i=t.width,a=t.height;return e+="width: "+i+"px;",e+="height: "+a+"px;",e},originalImageStyle:function(){var e="";e+="transform: scale("+this.cropImageAttr.scale+");";var t=w(this.cropViewWidth,this.cropViewHeight,this.cropImageAttr.width,this.cropImageAttr.height),i=t.width,a=t.height;return e+="width: "+i+"px;",e+="height: "+a+"px;",e}}),methods:{imageLoad:function(){b.call(this)}}},A=P,E=(i("9571"),Object(j["a"])(A,u,h,!1,null,null,null)),k=E.exports,N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"preview-view"},[i("p",[e._v("预览:")]),i("div",{directives:[{name:"show",rawName:"v-show",value:""===e.originalImageBase64,expression:"originalImageBase64 === ''"}],staticClass:"no-preview"},[e._v(" 无预览 ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.originalImageBase64,expression:"originalImageBase64 !== ''"}],staticClass:"preview"},[i("div",{staticClass:"square",style:e.getStyle},[e.ratio>1?i("canvas",{attrs:{width:e.previewUtinPx,height:e.ratio*e.previewUtinPx,id:"preview_square"}},[e._v("浏览器不支持canvas")]):e._e(),e.ratio<=1?i("canvas",{attrs:{width:e.ratio*e.previewUtinPx,height:e.previewUtinPx,id:"preview_square"}},[e._v("浏览器不支持canvas")]):e._e()])])])},S=[],U={props:{},data:function(){return{}},computed:Object(p["a"])(Object(p["a"])({},Object(g["c"])({originalImageBase64:"originalImageBase64"})),{},{getStyle:function(){var e="",t=0,i=0;return this.ratio>1?(t=this.previewUtinPx,i=this.ratio*this.previewUtinPx):(t=this.ratio*this.previewUtinPx,i=this.previewUtinPx),e+="width: "+t+"px;",e+="height: "+i+"px;",e}}),inject:["width","height","ratio","previewUtinPx"],methods:{}},V=U,H=(i("c899"),Object(j["a"])(V,N,S,!1,null,null,null)),T=H.exports,W=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"toolbar-view"},[i("div",{staticClass:"toolbar"},[i("span",{staticClass:"toolbar-item iconfont iconshangchuan",attrs:{title:"上传图片"},on:{click:e.upload}}),i("span",{staticClass:"toolbar-item iconfont iconbaocun",attrs:{title:"保存"},on:{click:e.save}}),i("span",{staticClass:"toolbar-item iconfont iconquxiao1",attrs:{title:"清空"},on:{click:e.clearAll}}),i("span",{staticClass:"toolbar-item iconfont iconwancheng",attrs:{title:"完成"},on:{click:e.complete}})]),e._m(0)])},$=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("input",{staticStyle:{display:"none"},attrs:{id:"upload-input",type:"file"}})])}],q=(i("b449"),i("85ff")),L={data:function(){return{scaleNumber:100}},computed:Object(p["a"])({},Object(g["c"])({originalImageBase64:"originalImageBase64"})),inject:["width","height"],methods:Object(p["a"])(Object(p["a"])({},Object(g["b"])(["setOriginalImageBase64","clearAllImage","setCropImageAttr"])),{},{scale:function(e){var t=this.scaleNumber,i=1;if("-"==e){if(t<=10)return;this.scaleNumber-=10}else this.scaleNumber+=10;i=this.scaleNumber/100,this.setCropImageAttr({scale:i});var a=document.getElementById("crop_frame_view"),n={width:a.offsetWidth,height:a.offsetHeight,left:a.offsetLeft,top:a.offsetTop};console.log(n)},upload:function(){var e=this,t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("style","display: none;"),t.setAttribute("accept","image/gif,image/jpeg,image/jpg,image/png"),t.onchange=Object(q["a"])(regeneratorRuntime.mark((function i(){var a,n,r,o,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(I("crop_frame_view"),a=t.files[0],!a){i.next=9;break}return i.next=5,v(a);case 5:n=i.sent,r=n.width,o=n.height,s=n.result,e.setCropImageAttr({width:r,height:o}),e.setOriginalImageBase64(s);case 9:case"end":return i.stop()}}),i)}))),t.click()},save:function(e){if(""!==this.originalImageBase64){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var i=t.getContext("2d"),a=document.getElementById("original-image"),n=a.naturalWidth,r=a.naturalHeight,o=n/a.width,s=r/a.height,c=document.getElementById("crop_frame_view"),l=c.offsetLeft,u=c.offsetTop,h=c.offsetWidth,p=c.offsetHeight,f=l,d=u,g={left:f,top:d,width:h,height:p};if(i.drawImage(a,g.left*o,g.top*s,g.width*o,g.height*s,0,0,this.width,this.height),e){if(e.getFile){var v=t.toDataURL("image/jpeg",1);return"file"===e.type?m(v):v}}else x(t,"下载.png")}else alert("还未上传图片")},clearAll:function(){this.clearAllImage()},complete:function(){alert("功能正在开发中")}})},F=L,M=(i("043b"),Object(j["a"])(F,W,$,!1,null,null,null)),R=M.exports,X={props:{cropViewWidth:{type:Number,default:770},cropViewHeight:{type:Number,default:520},width:{type:Number,default:210},height:{type:Number,default:140},previewUtinPx:{type:Number,default:200},imageType:{type:String,default:"png"}},components:{MainCropView:k,Preview:T,Toolbar:R},provide:function(){return{cropViewWidth:this.cropViewWidth,cropViewHeight:this.cropViewHeight,width:this.width,height:this.height,ratio:this.width/this.height,previewUtinPx:this.previewUtinPx}},data:function(){return{}},methods:{downloadFile:function(){this.$refs.toolbar.save()},upload:function(){this.$refs.toolbar.upload()},clear:function(){this.$refs.toolbar.clearAll()},complete:function(){this.$refs.toolbar.complete()},getImageFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file",i={getFile:!0,name:e,type:t},a=this.$refs.toolbar.save(i);return a}}},Y=X,D=(i("d1cb"),Object(j["a"])(Y,c,l,!1,null,null,null)),J=D.exports,z={components:{Crop:J},data:function(){return{}},methods:{}},G=z,K=(i("def2"),Object(j["a"])(G,o,s,!1,null,null,null)),Q=K.exports,Z={name:"App",components:{CropContainer:Q}},ee=Z,te=(i("5c0b"),Object(j["a"])(ee,n,r,!1,null,null,null)),ie=te.exports;a["a"].use(g["a"]);var ae=new g["a"].Store({state:{originalImage:{},originalImageBase64:"",cropImage:{},cropImageAttr:{scale:1,width:0,height:0}},getters:{},mutations:{setOriginalImageBase64:function(e,t){e.originalImageBase64=t},clearAllImage:function(e){e.originalImageBase64=""},setCropImageAttr:function(e,t){e.cropImageAttr=Object(p["a"])(Object(p["a"])({},e.cropImageAttr),t)}},actions:{}});a["a"].config.productionTip=!1,new a["a"]({store:ae,render:function(e){return e(ie)}}).$mount("#app")},"5c0b":function(e,t,i){"use strict";var a=i("3576"),n=i.n(a);n.a},6972:function(e,t,i){},9571:function(e,t,i){"use strict";var a=i("d7ad"),n=i.n(a);n.a},c899:function(e,t,i){"use strict";var a=i("2367"),n=i.n(a);n.a},d1cb:function(e,t,i){"use strict";var a=i("ebad"),n=i.n(a);n.a},d7ad:function(e,t,i){},def2:function(e,t,i){"use strict";var a=i("299f"),n=i.n(a);n.a},e84e:function(e,t,i){"use strict";var a=i("6972"),n=i.n(a);n.a},ebad:function(e,t,i){}});